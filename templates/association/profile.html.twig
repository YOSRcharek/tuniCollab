<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="{{ asset('assets/front/css/profile.css') }}" rel="stylesheet">
<link rel="icon" type="image/x-icon" href="{{ asset('assets/front/images/grandLogo.png') }}" />
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript">
</script>
<title>{% block title %}TuniCollab{% endblock %}</title>

    {% block stylesheets %}
    <link href="{{ asset('assets/front/css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ asset('assets/front/css/bootstrap-icons.css') }}" rel="stylesheet">
    <link href="{{ asset('assets/front/css/templatemo-kind-heart-charity.css') }}" rel="stylesheet">
    {% endblock %}

    {% block javascripts %}
    <script src="{{ asset('assets/front/js/jquery.min.js') }}"></script>
    <script src="{{ asset('assets/front/js/bootstrap.min.js') }}"></script>
    <script src="{{ asset('assets/front/js/jquery.sticky.js') }}"></script>
    <script src="{{ asset('assets/front/js/custom.js') }}"></script>
    <script src="{{ asset('assets/front/js/counter.js') }}"></script>
    <script src="{{ asset('assets/front/js/click-scroll.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Récupérer les éléments de lien des onglets
            var teamLink = document.getElementById('team-link');
            var projectsLink = document.getElementById('projects-link');
        
            // Récupérer les éléments de carte correspondants
            var teamCard = document.getElementById('team-card');
            var projectsCard = document.getElementById('projects-card');
        
            // Définir la carte des projets comme active au chargement de la page
            projectsCard.style.display = 'block';
            teamCard.style.display = 'none';
            projectsLink.classList.add('active');
            teamLink.classList.remove('active');
        
            // Ajouter des écouteurs d'événements aux liens des onglets
            teamLink.addEventListener('click', function() {
                // Afficher la carte de l'équipe et masquer la carte des projets
                teamCard.style.display = 'block';
                projectsCard.style.display = 'none';
        
                // Ajouter/retirer les classes actives pour les styles d'onglet
                teamLink.classList.add('active');
                projectsLink.classList.remove('active');
            });
        
            projectsLink.addEventListener('click', function() {
                // Afficher la carte des projets et masquer la carte de l'équipe
                projectsCard.style.display = 'block';
                teamCard.style.display = 'none';
        
                // Ajouter/retirer les classes actives pour les styles d'onglet
                projectsLink.classList.add('active');
                teamLink.classList.remove('active');
            });
        });
    </script> 
    {% endblock %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        /* CSS styling for map container */
        #map { width: 100%; height: 400px; }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Accessing the variables rendered in Twig
            const ongoingProjectsCount = {{ ongoingProjectsCount }};
            const completedProjectsCount = {{ completedProjectsCount }};

            const ctx = document.getElementById('myChart').getContext('2d');

            // Create a doughnut chart using the data
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        label: 'Project',
                        data: [completedProjectsCount, ongoingProjectsCount],
                        backgroundColor: ['#422006', '#854d0e'],
                    }],
                    labels: ['Terminé', 'En cours'],
                },
                options: {
                    cutoutPercentage: 80,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    },
                    elements: {
                        arc: {
                            borderWidth: 0,
                            borderColor: 'transparent',
                        }
                    },
                }
            });
        });
    </script>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    
    {{ include('home/header.html.twig') }}
    {% block body %}
    
 <div class="container">
    <div class="row">
        <div class="col-md-8 mt-4">

            <div class="card">
                <div class="card-body pb-0">
                    <div class="row align-items-center">
                        <div class="col-md-3">
                            <div class="text-center border-end">
                                <img src="{{asset('assets/front/images/group-people-volunteering-foodbank-poor-people.jpg')}}" class="img-fluid avatar-xxl rounded-circle" />
                           
                                <h5 class="mb-3">{{ association.nom }}</h5>
                            </div>
                        </div><!-- end col -->
                        <div class="col-md-9">
                            <div class="ms-3">
                                <div>
                                    <h5 class="mb-lg-3">Profile</h5>
                                    <p class="mb-0 text-muted">{{ association.description }}</p>
                                </div>
                                <div class="row my-4">
                                    <div class="col-md-12">
                                        <div>
                                            <p class="text-muted mb-2 fw-medium"><i class="mdi mdi-email-outline me-2"></i> {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                       
                      
                                                {{ app.user.email }}
                                           
                                    {% else %}
                                  
                                    {% endif %}
                                            </p>
                                            <p class="text-muted fw-medium mb-0"><i class="mdi mdi-phone-in-talk-outline me-2"></i>{{ association.telephone }}
                                            </p>
                                        </div>
                                    </div><!-- end col -->
                                </div><!-- end row -->
                             
                                <ul class="nav nav-tabs nav-tabs-custom border-bottom-0 mt-3 nav-justfied" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link px-4 " id="projects-link"  href="#">
                                            <span class="d-block d-sm-none"><i class="fas fa-home"></i></span>
                                            <span class="d-none d-sm-block">Projects</span>
                                          
                    
                                        </a>
                                    </li><!-- end li -->
                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link px-4 active" data-bs-toggle="tab" id="team-link"  href="#" role="tab" aria-selected="false" tabindex="-1">
                                            <span class="d-block d-sm-none"><i class="mdi mdi-menu-open"></i></span>
                                            <span class="d-none d-sm-block">Team</span>
                                        </a>
                                    </li><!-- end li -->
                                  
                                </ul><!-- end ul -->
                            </div>
                        </div><!-- end col -->
                    </div><!-- end row -->
                </div><!-- end card body -->
            </div>
            <div class="card" id="team-card">
                <div class="tab-content p-4"> 
                    {{ include('membre/index.html.twig', {'membres': membres, 'form': form,'ID':association.id}) }}     
                </div>
            </div>
            
            <div class="card project" id="projects-card">
                <div class="tab-content p-4">
                    {{ include('projet/index.html.twig', {'projets': projets, 'form': form2 ,'ID':association.id}) }}     
                </div>
            </div>
        </div>
        </div>
        <div class="col-md-4 mt-4">
            <div class="card">
                <div class="custom-text-box mb-lg-0">
                    <h5 class="mb-3">Our Mission</h5>
    
                    <p>Sed leo nisl, posuere at molestie ac, suscipit auctor quis metus</p>
    
                    <ul class="custom-list mt-2">
                        <li class="custom-list-item d-flex">
                            <i class="bi-check custom-text-box-icon me-2"></i>
                            Charity Theme
                        </li>
    
                        <li class="custom-list-item d-flex">
                            <i class="bi-check custom-text-box-icon me-2"></i>
                            Semantic HTML
                        </li>
                    </ul>    
                <hr>
                <div class="pt-2">
                    <div class="tags-block">
                        <h5 class="mb-3">SKILLS</h5>
    
                        <a href="#" class="tags-block-link">
                            Donation
                        </a>
    
                        <a href="#" class="tags-block-link">
                            Clothing
                        </a>
    
                        <a href="#" class="tags-block-link">
                            Food
                        </a>
    
                        <a href="#" class="tags-block-link">
                            Children
                        </a>
    
                        <a href="#" class="tags-block-link">
                            Education
                        </a>
    
                        <a href="#" class="tags-block-link">
                            Poverty
                        </a>
    
                        <a href="#" class="tags-block-link">
                            Clean Water
                        </a>
                    </div>
                </div>
            </div>
           
        </div>
        <div class="card">
            <div class="card-body">
                <div>
                    <h5 class="mb-3">Project static</h5>
                    <div class="table-responsive">
                        <div class="container px-8 mx-auto grid">
                              
                            <canvas id="myChart"></canvas>      
                          </div>
                    </div>
                </div>
            </div><!-- end card body -->
        </div><!-- end card -->
    
        <div class="card">
            <div class="card-body">
                <div>
                    <h5 class="mb-3">Location</h5>

                    <div id="map"></div>
                    <script>
                        // Initialize Mapbox map
                        mapboxgl.accessToken = 'pk.eyJ1IjoieW9zcmNoYXJlazMxIiwiYSI6ImNsdDZkd2JzcTBjcHYybW12NzE4aGNseDYifQ.pv6x004655o_tl9uncoxag';
                        var map = new mapboxgl.Map({
                            container: 'map', // Container ID
                            style: 'mapbox://styles/mapbox/streets-v11', // Map style to use
                            zoom: 8 // Starting zoom level
                        });
                    
                        // Get the address from PHP and convert it to coordinates
                        var address = '{{ association.adresse }}';
                    
                        fetch('https://api.mapbox.com/geocoding/v5/mapbox.places/' + encodeURIComponent(address) + '.json?access_token=' + mapboxgl.accessToken)
                            .then(response => response.json())
                            .then(data => {
                                // Extract the coordinates from the response
                                var coordinates = data.features[0].geometry.coordinates;
                    
                                // Set the map center to the coordinates
                                map.setCenter(coordinates);
                    
                                // Add a marker to the map
                                new mapboxgl.Marker()
                                    .setLngLat(coordinates) // Marker position [lng, lat]
                                    .addTo(map);
                            })
                            .catch(error => {
                                console.error('Error fetching coordinates:', error);
                            });
                    </script>
                    
                </div>
            </div><!-- end card-body -->
        </div>
        </div>
    </div>
 </div>
    
    {% endblock %}

    {{ include('home/footer.html.twig') }}
</body>
</html>